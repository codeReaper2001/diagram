<mxfile host="65bd71144e">
    <diagram id="gWG34eJznuLCkYyBdfT5" name="第 1 页">
        <mxGraphModel dx="1161" dy="670" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="71" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="745" y="2520" width="400" height="620" as="geometry"/>
                </mxCell>
                <mxCell id="5" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;sketch=1;" parent="1" source="2" target="3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="ObjectMonitor维护的重要字段" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="410" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="7" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="3" target="6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;ObjectMonitor&lt;/span&gt;() {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; // 重入次数&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_owner&lt;/span&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; // 占有锁的线程&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_WaitSet&lt;/span&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; // 条件队列&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt; ;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp;// 同步队列cxq&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_EntryList&lt;/span&gt; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt; ;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp;// 同步队列&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="190" y="330" width="260" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="即ObjectMonitor中维护了&lt;b&gt;三个队列&lt;/b&gt;：&lt;b&gt;cxq&lt;/b&gt;、&lt;b&gt;EntryList&lt;/b&gt;和&lt;b&gt;WaitSet&lt;/b&gt;：&lt;br&gt;① cxq和EntryList都是阻塞队列&lt;br&gt;（同步队列，类似AQS中的双向链表，cxq是单向链表，EntryList为双向链表）&lt;br&gt;② WaitSet是条件队列" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="480" y="392.5" width="350" height="75" as="geometry"/>
                </mxCell>
                <mxCell id="12" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="8" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="ObjectMonitor是什么" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="200" y="30" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="10" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="9" target="8" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="14" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="9" target="13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="ObjectMonitor概念" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="80" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="ObjectMonitor可以理解为在jvm层面用于解决临界区代码并发访问的&lt;b&gt;锁资源&lt;/b&gt;。它其实是jvm在&lt;b&gt;执行同步代码块&lt;/b&gt;时会&lt;b&gt;生成的一个c++对象&lt;/b&gt;，用于保证临界区代码同时只能有一个线程执行" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="354" y="10" width="256" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="16" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="13" target="15" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="什么时候会产生ObjectMonitor?" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="200" y="140" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="18" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="15" target="17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="15" value="案例代码" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="354" y="145" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="20" value="字节码" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="17" target="19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="17" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;public class &lt;/span&gt;&lt;span style=&quot;color: #066555&quot;&gt;Main &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;color: #0033b3&quot;&gt;public static void &lt;/span&gt;&lt;span style=&quot;color: #795e26&quot;&gt;main&lt;/span&gt;(&lt;span style=&quot;color: #066555&quot;&gt;String&lt;/span&gt;[] args) {&lt;br&gt;        &lt;span style=&quot;color: #066555&quot;&gt;Object &lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;obj &lt;/span&gt;= &lt;span style=&quot;color: #0033b3&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;color: #795e26&quot;&gt;Object&lt;/span&gt;();&lt;br&gt;        &lt;span style=&quot;color: #0033b3&quot;&gt;int &lt;/span&gt;i = &lt;span style=&quot;color: #1750eb&quot;&gt;0&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;color: #0033b3&quot;&gt;synchronized &lt;/span&gt;(&lt;span style=&quot;color: #000000&quot;&gt;obj&lt;/span&gt;) {&lt;br&gt;            i++;&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;color: #066555&quot;&gt;System&lt;/span&gt;.&lt;span style=&quot;color: #871094 ; font-style: italic&quot;&gt;out&lt;/span&gt;.&lt;span style=&quot;color: #795e26&quot;&gt;println&lt;/span&gt;(i);&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="450" y="90" width="270" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;comic=1;sketch=1;fontSize=11;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/image-20220816200220585.png;imageBorder=default;" parent="1" vertex="1">
                    <mxGeometry x="780" y="19.5" width="416.3" height="281" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#b85450;comic=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="795" y="110" width="110" height="78" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="monitorenter和monitorexit指令" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="780" y="310" width="170" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="然后在执行的过程中先添加偏向锁，后依次升级为轻量级锁和重量级锁，而ObjectMonitor则是最终需要的&lt;b&gt;重量级锁&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="457" y="250" width="256" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="解释执行&lt;br&gt;monitorenter" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="25" target="27" edge="1">
                    <mxGeometry x="-0.1111" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="25" value="monitorenter加锁流程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="665" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="调用ObjectSynchronizer::slow_enter()" style="edgeStyle=orthogonalEdgeStyle;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;rounded=0;" parent="1" source="27" target="31" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #4078f2&quot;&gt;IRT_ENTRY_NO_ASYNC&lt;/span&gt;(&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt;, &lt;span style=&quot;color: #c18401&quot;&gt;InterpreterRuntime&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;monitorenter&lt;/span&gt;(&lt;span style=&quot;color: #c18401&quot;&gt;JavaThread&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; thread, &lt;span style=&quot;color: #c18401&quot;&gt;BasicObjectLock&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; elem))&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#a626a4&quot;&gt;&amp;nbsp; ...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;UseBiasedLocking&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; // Retry fast entry if bias is revoked to avoid unnecessary inflation&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectSynchronizer&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;fast_enter&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;h_obj&lt;/span&gt;, elem-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;lock&lt;/span&gt;(), &lt;span style=&quot;color: #986801&quot;&gt;true&lt;/span&gt;, &lt;span style=&quot;color: #4078f2&quot;&gt;CHECK&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; } &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectSynchronizer&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;slow_enter&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;h_obj&lt;/span&gt;, elem-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;lock&lt;/span&gt;(), &lt;span style=&quot;color: #4078f2&quot;&gt;CHECK&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #4078f2&quot;&gt;IRT_END&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="200" y="570" width="620" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="29" value="hotspot\src\share\vm\interpreter\interpreterRuntime.cpp" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="200" y="550" width="298" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;① 如果配置使用偏向锁的话，会优先使用fast_enter方法执行获取偏向锁的逻辑&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;② 否则使用slow_enter方法优先获取轻量级锁&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="830" y="650" width="290" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="53" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="31" target="35" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectSynchronizer&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;slow_enter&lt;/span&gt;(&lt;span style=&quot;color: #c18401&quot;&gt;Handle&lt;/span&gt; obj, &lt;span style=&quot;color: #c18401&quot;&gt;BasicLock&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; lock, &lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;markOop&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;mark&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; obj-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;mark&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectSynchronizer&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;inflate&lt;/span&gt;(&lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt;, obj())-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;enter&lt;/span&gt;(&lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="200" y="860" width="450" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="33" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;/div&gt;&lt;span style=&quot;text-align: left&quot;&gt;前面会尝试&lt;b&gt;添加轻量级锁&lt;/b&gt;，如果&lt;b&gt;加锁失败&lt;/b&gt;，则会执行锁膨胀，得到&lt;b&gt;重量级锁&lt;/b&gt;（即创建关联的ObjectMonitor对象），进而再进入&lt;b&gt;重量级锁的加锁流程&lt;/b&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="670" y="890" width="310" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="36" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontSize=11;sketch=1;rounded=0;" parent="1" source="34" target="35" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="34" value="ObjectMonitor加锁流程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="1090" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="52" style="rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="35" target="43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="55" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="35" target="54" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="35" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;ATTR&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;enter&lt;/span&gt;(&lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(228 , 86 , 73)&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 38 , 164)&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 38 , 164)&quot;&gt;const&lt;/span&gt; Self &lt;span style=&quot;color: rgb(166 , 38 , 164)&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: rgb(64 , 120 , 242)&quot;&gt;THREAD&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;cur&lt;/span&gt; ;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;cur&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;Atomic&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;cmpxchg_ptr&lt;/span&gt; (Self, &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_owner&lt;/span&gt;, &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) ;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;cur&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; Self) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(228 , 86 , 73)&quot;&gt;_recursions&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 38 , 164)&quot;&gt;++&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;is_lock_owned&lt;/span&gt; ((&lt;span style=&quot;color: #e45649&quot;&gt;address&lt;/span&gt;)cur)) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;1&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;_owner&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; Self ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;OwnerIsThread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;1&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Knob_SpinEarly&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;TrySpin&lt;/span&gt; (Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; // Prevent deflation at STW-time. &amp;nbsp;See deflate_idle_monitors() and is_busy().&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; // Ensure the object-monitor relationship remains stable while there's contention.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;Atomic&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;inc_ptr&lt;/span&gt;(&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_count&lt;/span&gt;);&lt;/div&gt;&amp;nbsp; ...&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; {&lt;/div&gt;&amp;nbsp; &amp;nbsp; ...&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;for&lt;/span&gt; (;;) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;EnterI&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt;) ;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;exit&lt;/span&gt; (&lt;span style=&quot;color: #986801&quot;&gt;false&lt;/span&gt;, Self) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;Atomic&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;dec_ptr&lt;/span&gt;(&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_count&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; ...&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;}&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="160" y="1000" width="516" height="870" as="geometry"/>
                </mxCell>
                <mxCell id="38" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;尝试cas获取锁&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="488" y="1090" width="90" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="39" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;如果是当前线程，则是锁重入，重入次数++&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="321" y="1150" width="106" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="40" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;cas获取锁成功：&lt;br&gt;① 重入次数设为1&lt;br&gt;② 占有锁线程设为自己&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="321" y="1260" width="106" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;再次尝试cas+自旋获取&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1380" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="42" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;获取不到锁，走进入阻塞队列流程&lt;br&gt;这一步非常类似于AQS的acquireQueued&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="314" y="1640" width="186" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="43" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;ATTR&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;EnterI&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; Self &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TryLock&lt;/span&gt; (Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TrySpin&lt;/span&gt; (Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; // Enqueue &quot;Self&quot; on ObjectMonitor's _cxq.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;(Self) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_ParkEvent&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;reset&lt;/span&gt;() ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;_prev&lt;/span&gt; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; (&lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt;) &lt;span style=&quot;color: #986801&quot;&gt;0xBAD&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_CXQ&lt;/span&gt; ;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; // Push &quot;Self&quot; onto the front of the _cxq.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;nxt&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;for&lt;/span&gt; (;;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;_next&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;nxt&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #c18401&quot;&gt;Atomic&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;cmpxchg_ptr&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt;, &lt;span style=&quot;color: #e45649&quot;&gt;nxt&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;nxt&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;break&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TryLock&lt;/span&gt; (Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;for&lt;/span&gt; (;;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TryLock&lt;/span&gt; (Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;break&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // park self&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;_Responsible&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; Self &lt;span style=&quot;color: #a626a4&quot;&gt;||&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;SyncFlags&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;1&lt;/span&gt;)) {&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_ParkEvent&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;park&lt;/span&gt; ((&lt;span style=&quot;color: #e45649&quot;&gt;jlong&lt;/span&gt;) RecheckInterval) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;TryLock&lt;/span&gt;(Self) &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;break&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66) ; font-size: 11px&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="710" y="980" width="410" height="890" as="geometry"/>
                </mxCell>
                <mxCell id="44" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;尝试cas获取锁&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="900" y="1060" width="90" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="45" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;再次尝试cas+自旋获取&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="900" y="1120" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="46" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;cas将ObjectWaiter插入到cxq队列头部&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="930" y="1370" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="47" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;封装当前线程为ObjectWaiter对象&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="1320" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="48" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;尝试cas获取锁&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="840" y="1450" width="90" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="49" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;尝试cas获取锁&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="950" y="1560" width="90" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="50" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;线程挂起&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="960" y="1626" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;被唤醒后竞争锁&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="790" y="1735" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="54" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;fontSize=11;strokeColor=default;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/88939215a4895e775db5af18cb625bc3.png;imageBorder=default;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="167.31" y="1910" width="501.38" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="59" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.002;entryY=0.142;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=11;" parent="1" source="56" target="58" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="56" value="ObjectMonitor解锁流程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="2420" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="58" target="60" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="116" value="&lt;font style=&quot;font-size: 12px&quot;&gt;流程&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="58" target="71" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="58" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;ATTR&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;exit&lt;/span&gt;(&lt;span style=&quot;color: #a626a4&quot;&gt;bool&lt;/span&gt; not_suspended, &lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; Self &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt; ;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;--&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// this is simple recursive enter&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;TEVENT&lt;/span&gt; (Inflated &lt;span style=&quot;color: #4078f2&quot;&gt;exit&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;-&lt;/span&gt; recursive) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;for&lt;/span&gt; (;;) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;QMode&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;Knob_QMode&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;QMode&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;2&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {...}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;QMode&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;3&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {...}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;QMode&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;4&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {...}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_EntryList&lt;/span&gt; &amp;nbsp;;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;ExitEpilog&lt;/span&gt; (Self, &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; // If we find that both _cxq and EntryList are null then just&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; // re-run the exit protocol from the top.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;continue&lt;/span&gt; ;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(160 , 161 , 167) ; font-style: italic&quot;&gt;// The following loop is tantamount to: w = swap (&amp;amp;cxq, NULL)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;for&lt;/span&gt; (;;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;assert&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;Invariant&quot;&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;u&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; (&lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt;) &lt;span style=&quot;color: #c18401&quot;&gt;Atomic&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;cmpxchg_ptr&lt;/span&gt; (&lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;, &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_cxq&lt;/span&gt;, &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;u&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;break&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;u&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;QMode&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;1&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; } &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// QMode == 0 or QMode == 2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;br&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_EntryList&lt;/span&gt; &amp;nbsp;;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;ExitEpilog&lt;/span&gt; (Self, &lt;span style=&quot;color: #e45649&quot;&gt;w&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;return&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="167.31" y="2280" width="513" height="1170" as="geometry"/>
                </mxCell>
                <mxCell id="60" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;ExitEpilog&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; Self, &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; Wakee) {&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;ParkEvent&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;Trigger&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; Wakee-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_event&lt;/span&gt; ;&lt;/div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp;...&lt;/font&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;Trigger&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;unpark&lt;/span&gt;() ;&lt;/div&gt;&amp;nbsp; &amp;nbsp;...&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="720" y="2280" width="430" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="62" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;唤醒cxq首节点线程&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="440" y="2540" width="100" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="63" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;① 将cxq链表补成双向链表&lt;br&gt;② 拼接在EntryList后面&lt;br&gt;③ cxq = NULL&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="440" y="2580" width="130" height="44" as="geometry"/>
                </mxCell>
                <mxCell id="64" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;① 将cxq链表补成双向链表&lt;br&gt;② 拼接在在EntryList&lt;b&gt;前面&lt;br&gt;&lt;/b&gt;③ cxq = NULL&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="439" y="2635" width="130" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="65" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;唤醒EntryList队首元素&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="370" y="2744" width="130" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="66" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;cas清空cxq&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="488" y="3010" width="61" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="67" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;w=原cxq队列队首指针&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="314" y="3090" width="111" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="68" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;① 反转cxq队列并改成双向链表&lt;br&gt;② 赋值到EntryList&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="3130" width="150" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="69" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;① cxq队列改成双向链表&lt;br&gt;② 赋值到EntryList&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="414" y="3190" width="126" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="70" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;从EntryList取头结点进行唤醒&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="370" y="3340" width="136" height="23" as="geometry"/>
                </mxCell>
                <mxCell id="118" value="&lt;div style=&quot;text-align: left&quot;&gt;QMode=1时可以&lt;span&gt;实现先进先出&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="752" y="3020" width="95" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="72" value="锁重入次数--" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="832" y="2542" width="110" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="74" value="重入次数==0?" style="rhombus;whiteSpace=wrap;html=1;sketch=0;fontSize=11;strokeColor=#d79b00;fillColor=#ffe6cc;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="832" y="2594" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="75" style="rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="72" target="74" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="76" value="返回" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
                    <mxGeometry x="1065.1499999999999" y="2738" width="56.85" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="77" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="74" target="76" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="80" value="QMode" style="rhombus;whiteSpace=wrap;html=1;sketch=0;fontSize=11;strokeColor=#d79b00;fillColor=#ffe6cc;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="832" y="2651" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="79" value="是" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="74" target="80" edge="1">
                    <mxGeometry x="-0.2941" y="15" relative="1" as="geometry">
                        <mxPoint x="887" y="2650" as="targetPoint"/>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="84" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="82" target="76" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="唤醒cxq&lt;br&gt;首节点" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="942" y="2707" width="60" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="2" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="80" target="82" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="85" value="拼接cxq在EntryList后面" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="767" y="2707" width="80" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="86" value="3" style="rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="80" target="85" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="88" value="拼接cxq在EntryList前面" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="852" y="2707" width="80" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="90" value="4" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="80" target="88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="96" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="98" target="76" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="932" y="2810" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="97" value="EntryList是否为空" style="rhombus;whiteSpace=wrap;html=1;sketch=0;fontSize=11;strokeColor=#d79b00;fillColor=#ffe6cc;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="837" y="2790" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="93" value="0,1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="80" target="97" edge="1">
                    <mxGeometry x="0.3907" relative="1" as="geometry">
                        <mxPoint x="852" y="2810" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="762" y="2666"/>
                            <mxPoint x="762" y="2805"/>
                        </Array>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="94" style="rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="85" target="97" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="892" y="2791" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="88" target="97" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="892" y="2791" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="98" value="唤醒EntryList队首元素" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="982" y="2786" width="80" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="99" value="不空" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="97" target="98" edge="1">
                    <mxGeometry x="-0.1429" y="15" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="100" value="且cxq!=NULL" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="957" y="2680" width="100" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="101" value="cas设置&lt;br&gt;cxq=NULL" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="852" y="2850" width="80" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="102" value="空" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="97" target="101" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="103" value="QMode" style="rhombus;whiteSpace=wrap;html=1;sketch=0;fontSize=11;strokeColor=#d79b00;fillColor=#ffe6cc;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="837" y="2910" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="104" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="101" target="103" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="105" value="&lt;b&gt;反转&lt;/b&gt;原cxq队列并改成双向链表" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="802" y="2970" width="90" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="106" value="1" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="103" target="105" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="107" value="原cxq队列改成双向链表" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="902" y="2970" width="90" height="38" as="geometry"/>
                </mxCell>
                <mxCell id="108" value="0" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="103" target="107" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="109" value="赋值给EntryList" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="852" y="3030" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="110" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="105" target="109" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="111" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="107" target="109" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="902" y="3030" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="114" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="112" target="76" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="112" value="唤醒EntryList队首元素" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="852" y="3080" width="90" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="113" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="109" target="112" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="119" value="&lt;div style=&quot;text-align: left&quot;&gt;默认QMode=0，移动到EntryList，FILO&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="959.5" y="3020" width="100.5" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="120" value="&lt;div style=&quot;text-align: left&quot;&gt;① 默认情况下是优先唤醒EntryList中的线程&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;② 如果EntryList为空时再移动竞争队列cxq线程到EntryList中&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;③ 最后唤醒EntryList的线程&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="1156" y="2996.5" width="170" height="87" as="geometry"/>
                </mxCell>
                <mxCell id="123" style="rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="121" target="122" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="127" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="121" target="126" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="121" value="策略总结" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
                    <mxGeometry x="745" y="3253" width="55" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="125" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="122" target="124" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="122" value="只使用cxq队列" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="840" y="3200" width="93" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="124" value="策略2，且是FILO" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="968" y="3200" width="108" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="130" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="126" target="128" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="131" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="126" target="129" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="126" value="使用两个队列" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="841" y="3320" width="88" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="133" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="128" target="132" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="128" value="cxq优先" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="954" y="3270" width="82" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="135" value="综合" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="129" target="134" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="137" value="FIFO" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="129" target="136" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="140" value="FILO" style="edgeStyle=none;rounded=0;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="1" source="129" target="138" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="129" value="EntryList优先" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="954" y="3363" width="82" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="132" value="策略4，FILO" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1068" y="3270" width="82" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="134" value="策略3" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="3320" width="52" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="136" value="策略1" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="3363" width="52" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="138" value="&lt;b&gt;策略0&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="3410" width="52" height="33" as="geometry"/>
                </mxCell>
                <mxCell id="143" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.003;entryY=0.055;entryDx=0;entryDy=0;entryPerimeter=0;sketch=1;" edge="1" parent="1" source="141" target="142">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="141" value="ObjectMonitor wait流程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="3530" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="172" value="流程" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="142" target="152">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="810" y="3690" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="142" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;wait&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;jlong&lt;/span&gt; millis, &lt;span style=&quot;color: #a626a4&quot;&gt;bool&lt;/span&gt; interruptible, &lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;const&lt;/span&gt; Self &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt; ;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/font&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp;// create a node to be put into the queue&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;(Self);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_WAIT&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_ParkEvent&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;reset&lt;/span&gt;() ;&lt;br&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp;...&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinAcquire&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;WaitSet - add&quot;&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;AddWaiter&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinRelease&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;) ;&lt;/div&gt;&amp;nbsp; &amp;nbsp;...&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;intptr_t&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;save&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; // record the old recursion count&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;_waiters&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;++&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// increment the number of waiters&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // set the recursion level to be 1&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;exit&lt;/span&gt; (&lt;span style=&quot;color: #986801&quot;&gt;true&lt;/span&gt;, Self) ;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// exit the monitor&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp;// The thread is on the WaitSet list - now park() it.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;...&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;{&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; // State transition wrappers&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#c18401&quot;&gt;&amp;nbsp; ...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (interruptible &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;is_interrupted&lt;/span&gt;(&lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt;, &lt;span style=&quot;color: #986801&quot;&gt;false&lt;/span&gt;) &lt;span style=&quot;color: #a626a4&quot;&gt;||&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;HAS_PENDING_EXCEPTION&lt;/span&gt;)) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// Intentionally empty&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;_notified&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (millis &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_ParkEvent&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;park&lt;/span&gt; () ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;ret&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;Self&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;_ParkEvent&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;park&lt;/span&gt; (millis) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; // Exit thread safepoint: transition _thread_blocked -&amp;gt; _thread_in_vm&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_WAIT&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinAcquire&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;WaitSet - unlink&quot;&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_WAIT&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;DequeueSpecificWaiter&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;) ;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; // unlink from WaitSet&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;assert&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;_notified&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;invariant&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_RUN&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinRelease&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// The thread is now either on off-list (TS_RUN),&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// on the EntryList (TS_ENTER), or on the cxq (TS_CXQ).&lt;/span&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;...&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// Reentry phase -- reacquire the monitor.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;// re-enter contended monitor after object.wait().&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #c18401&quot;&gt;TStates&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;v&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;v&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_RUN&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;enter&lt;/span&gt; (Self) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;guarantee&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;v&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_ENTER&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;||&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;v&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_CXQ&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;invariant&quot;&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #4078f2&quot;&gt;ReenterI&lt;/span&gt; (Self, &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;node&lt;/span&gt;.&lt;span style=&quot;color: #4078f2&quot;&gt;wait_reenter_end&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;this&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;}&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; // OSThreadWaitState()&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;_recursions&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;save&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; // restore the old recursion count&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;_waiters&lt;/span&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;--&lt;/span&gt;;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // decrement the number of waiter&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="167.31" y="3470" width="580" height="1460" as="geometry"/>
                </mxCell>
                <mxCell id="144" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;创建一个放到等待队列的节点&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="425" y="3590" width="145" height="26" as="geometry"/>
                </mxCell>
                <mxCell id="145" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;① 自旋+cas获取等待队列操作锁&lt;br&gt;② &lt;b&gt;将当前线程节点放入到等待队列中&lt;/b&gt;&lt;br&gt;③ 释放队列锁&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="523.69" y="3650" width="166.31" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="146" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;只是为了保证入队操作的线程安全&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="571.85" y="3630" width="166.31" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="147" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;释放锁：&lt;br&gt;① 保存原来的重入次数在函数中&lt;br&gt;② 执行释放锁-&amp;gt;根据策略唤醒同步队列中的其他线程&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="578" y="3740" width="166.31" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="148" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;线程挂起&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="494.35" y="4081" width="45.65" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="149" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;被唤醒后&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="664.35" y="4189" width="45.65" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="150" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;从WaitSet链表中删除当前节点&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="524.35" y="4320" width="145.65" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="151" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;重新去获取锁&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="414" y="4630" width="76" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="215" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="1" source="213" target="214">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="213" value="ObjectMonitor notify流程" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" vertex="1" parent="1">
                    <mxGeometry x="40" y="5150" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="257" value="流程" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="1" source="214" target="222">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="214" value="&lt;div style=&quot;background-color: rgb(250 , 250 , 250) ; font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; font-size: 11px ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;consolas&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 22px&quot;&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a626a4&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectMonitor&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;notify&lt;/span&gt;(&lt;span style=&quot;color: #4078f2&quot;&gt;TRAPS&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #4078f2&quot;&gt;CHECK_OWNER&lt;/span&gt;();&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;int&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;Knob_MoveNotifyee&lt;/span&gt; ;&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinAcquire&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;, &lt;span style=&quot;color: #50a14f&quot;&gt;&quot;WaitSet - notify&quot;&lt;/span&gt;) ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;iterator&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;DequeueWaiter&lt;/span&gt;() ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;iterator&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;NULL&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#4078f2&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;4&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #e45649&quot;&gt;iterator&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #e45649&quot;&gt;TState&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt;::&lt;span style=&quot;color: #e45649&quot;&gt;TS_ENTER&lt;/span&gt; ;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;Thread&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; Self &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4078f2&quot;&gt;THREAD&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #c18401&quot;&gt;ObjectWaiter&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;List&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #e45649&quot;&gt;_EntryList&lt;/span&gt; ;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;0&lt;/span&gt;) {&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; // prepend to EntryList&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;1&lt;/span&gt;) {&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;// append to EntryList&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#383a42&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/font&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;2&lt;/span&gt;) {&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;// prepend to cxq&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(166 , 38 , 164)&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;3&lt;/span&gt;) {&lt;span style=&quot;color: #a0a1a7 ; font-style: italic&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;// append to cxq&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#e45649&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;} &lt;span style=&quot;color: #a626a4&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#c18401&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #a626a4&quot;&gt;if&lt;/span&gt; (&lt;span style=&quot;color: #e45649&quot;&gt;Policy&lt;/span&gt; &lt;span style=&quot;color: #a626a4&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&quot;color: #986801&quot;&gt;4&lt;/span&gt;) {&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;color: #e45649&quot;&gt;iterator&lt;/span&gt;-&amp;gt;&lt;span style=&quot;color: #4078f2&quot;&gt;wait_reenter_begin&lt;/span&gt;(&lt;span style=&quot;color: #e45649&quot;&gt;this&lt;/span&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; }&lt;/div&gt;&lt;br&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;span style=&quot;color: #c18401&quot;&gt;Thread&lt;/span&gt;::&lt;span style=&quot;color: #4078f2&quot;&gt;SpinRelease&lt;/span&gt; (&lt;span style=&quot;color: #a626a4&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #e45649&quot;&gt;_WaitSetLock&lt;/span&gt;) ;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(56 , 58 , 66)&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;font color=&quot;#a626a4&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(56 , 58 , 66) ; font-size: 11px&quot;&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" vertex="1" parent="1">
                    <mxGeometry x="167.31" y="4950" width="364" height="890" as="geometry"/>
                </mxCell>
                <mxCell id="216" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;从WaitSet中取队头节点&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="444.35" y="5120" width="115.65" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="217" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;策略0：添加到EntryList的前面&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="356" y="5350" width="154" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="218" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;策略1：添加到EntryList的后面&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="355" y="5420" width="154" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="219" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;策略2&lt;/b&gt;：&lt;br&gt;① EntryList为空时优先放到EntryList&lt;br&gt;② 添加到cxq的前面&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="356" y="5480" width="176" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="220" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;策略3：添加到cxq的后面&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=default;comic=1;align=left;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="355" y="5550" width="126" height="22" as="geometry"/>
                </mxCell>
                <mxCell id="241" value="" style="group" vertex="1" connectable="0" parent="1">
                    <mxGeometry x="810" y="3620" width="680" height="430" as="geometry"/>
                </mxCell>
                <mxCell id="211" value="线程节点是在其他线程执行notify时移动到cxq或EntryList中，但唤醒则是在拥有锁的线程执行exit时才会唤醒" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;sketch=1;" vertex="1" parent="241">
                    <mxGeometry x="480" y="210" width="200" height="61.5" as="geometry"/>
                </mxCell>
                <mxCell id="212" value="唤醒&lt;br&gt;时机" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="241" source="191" target="211">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="152" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;align=left;" vertex="1" parent="241">
                    <mxGeometry width="430" height="430" as="geometry"/>
                </mxCell>
                <mxCell id="153" value="将当前线程封装成ObjectWaiter放入条件队列" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="241">
                    <mxGeometry x="65" y="20" width="162" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="154" value="释放锁&lt;br&gt;（这一步就会唤醒阻塞队列的后继线程）" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="241">
                    <mxGeometry x="36.5" y="80" width="219" height="41" as="geometry"/>
                </mxCell>
                <mxCell id="155" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="153" target="154">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="156" value="线程挂起" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" vertex="1" parent="241">
                    <mxGeometry x="107.25" y="144.5" width="77.5" height="31" as="geometry"/>
                </mxCell>
                <mxCell id="157" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="154" target="156">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="159" value="从WaitSet中删除原节点" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="241">
                    <mxGeometry x="65" y="210" width="162" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="160" value="被唤醒后" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="156" target="159">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="161" value="重新到队列中自旋+cas获取锁" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" vertex="1" parent="241">
                    <mxGeometry x="65" y="263" width="162" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="162" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="159" target="161">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="165" value="类似EnterI" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;sketch=1;" vertex="1" parent="241">
                    <mxGeometry x="236" y="280" width="78" height="31.5" as="geometry"/>
                </mxCell>
                <mxCell id="167" value="恢复原来的锁重入次数" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="241">
                    <mxGeometry x="65" y="330" width="162" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="168" value="获取锁成功" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="161" target="167">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="146" y="350" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="169" value="返回" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="241">
                    <mxGeometry x="123.5" y="380" width="45" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="170" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="241" source="167" target="169">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="191" value="因为此时被唤醒时已经被notify方法移动到cxq或EntryList了，所以不需要主动移动节点" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;sketch=1;" vertex="1" parent="241">
                    <mxGeometry x="236" y="210" width="184" height="61.5" as="geometry"/>
                </mxCell>
                <mxCell id="258" value="" style="group" vertex="1" connectable="0" parent="1">
                    <mxGeometry x="593" y="5043" width="480" height="260" as="geometry"/>
                </mxCell>
                <mxCell id="222" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;align=left;" vertex="1" parent="258">
                    <mxGeometry width="480" height="260" as="geometry"/>
                </mxCell>
                <mxCell id="223" value="从WaitSet中取头结点" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="258">
                    <mxGeometry x="168.5" y="15" width="137" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="225" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="258" source="223" target="242">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="203" y="70" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="242" value="Policy" style="rhombus;whiteSpace=wrap;html=1;sketch=0;fontSize=11;strokeColor=#d79b00;fillColor=#ffe6cc;comic=1;" vertex="1" parent="258">
                    <mxGeometry x="182" y="70" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="243" value="添加到EntryList前面" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="258">
                    <mxGeometry x="18.66999999999996" y="140" width="81.33" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="244" value="0" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="242" target="243">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="245" value="添加到EntryList后面" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="258">
                    <mxGeometry x="103.84000000000003" y="140" width="81.33" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="246" value="1" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="242" target="245">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="247" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;① EntryList为空优先放到EntryList&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;② 添加到cxq前面&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="258">
                    <mxGeometry x="195" y="140" width="185" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="248" value="2" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="242" target="247">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="250" value="添加到cxq后面" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;" vertex="1" parent="258">
                    <mxGeometry x="383.82000000000005" y="140" width="86.18" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="251" value="3" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="242" target="250">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="252" value="结束" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="258">
                    <mxGeometry x="214.67000000000007" y="214.75" width="50.67" height="28.5" as="geometry"/>
                </mxCell>
                <mxCell id="253" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="243" target="252">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="254" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="258" source="245" target="252">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="240" y="220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="255" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;" edge="1" parent="258" source="247" target="252">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="256" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="258" source="250" target="252">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="259" value="① 其实notify并没有进行唤醒线程的操作，而只是从条件队列中取出一个节点，根据策略放入到同步队列中去。&lt;br&gt;② 唤醒的操作是当前线程释放锁时才会进行来唤醒阻塞队列的后继节点。" style="rounded=0;whiteSpace=wrap;html=1;comic=1;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="591" y="5330" width="229" height="90" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>