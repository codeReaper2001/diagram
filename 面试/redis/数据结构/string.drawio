<mxfile host="65bd71144e">
    <diagram id="2hPQVOYOipwQLmy5uQ9p" name="第 1 页">
        <mxGraphModel dx="968" dy="558" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="146" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" edge="1" parent="1" source="143" target="145">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="143" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" vertex="1" parent="1">
                    <mxGeometry x="445" y="979.25" width="400" height="85.75" as="geometry"/>
                </mxCell>
                <mxCell id="5" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;sketch=1;" parent="1" source="2" target="4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="10" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="2" target="9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="redisObject" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="106.25" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="8" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="4" target="6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="redisObject是什么" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="160" y="60" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="redis中所有类型的value都会封装成redisObject结构，相当于value的基类或接口" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="309" y="53.75" width="241" height="42.5" as="geometry"/>
                </mxCell>
                <mxCell id="12" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="9" target="11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="17" style="edgeStyle=none;sketch=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="9" target="16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="redisObject结构" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="160" y="160" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="82" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="11" target="81" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="84" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="11" target="83" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;typedef struct &lt;/span&gt;&lt;span style=&quot;color: #008080&quot;&gt;redisObject &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;color: #0033b3&quot;&gt;unsigned &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;type&lt;/span&gt;:&lt;span style=&quot;color: #1750eb&quot;&gt;4&lt;/span&gt;;&lt;br&gt;    &lt;span style=&quot;color: #0033b3&quot;&gt;unsigned &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;encoding&lt;/span&gt;:&lt;span style=&quot;color: #1750eb&quot;&gt;4&lt;/span&gt;;&lt;br&gt;    &lt;span style=&quot;color: #0033b3&quot;&gt;unsigned &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;lru&lt;/span&gt;:&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;LRU_BITS&lt;/span&gt;; &lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* LRU time (relative to global lru_clock) or&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;                            * LFU data (least significant 8 bits frequency&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;                            * and most significant 16 bits access time). */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;refcount&lt;/span&gt;;&lt;br&gt;    &lt;span style=&quot;color: #0033b3&quot;&gt;void &lt;/span&gt;*&lt;span style=&quot;color: #660e7a&quot;&gt;ptr&lt;/span&gt;;&lt;br&gt;} &lt;span style=&quot;color: #371f80&quot;&gt;robj&lt;/span&gt;;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="309" y="115" width="460" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="14" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;数据类型&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="460" y="120" width="50" height="26.25" as="geometry"/>
                </mxCell>
                <mxCell id="15" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;底层实现类型&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="460" y="133.75" width="70" height="26.25" as="geometry"/>
                </mxCell>
                <mxCell id="19" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="16" target="21" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="309" y="295" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="16" value="面向对象的思维" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="160" y="315" width="110" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="309" y="240" width="321" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="20" target="26" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="459" y="270" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="30" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="20" target="25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="31" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="20" target="27" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="32" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="20" target="28" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="33" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="20" target="29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="20" value="redisObject" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="310" width="91" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="子类或实现类" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="530" y="375" width="90" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="25" value="list" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="454.5" y="285" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="37" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="26" target="34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="39" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="26" target="35" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="40" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="26" target="36" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="string" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="454.5" y="250" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="hash" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="454.5" y="317.5" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="set" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="454.5" y="350" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="29" value="zset" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="454.5" y="385" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="34" value="intStr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="540" y="250" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="35" value="embStr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="540" y="285" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="36" value="rawStr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="540" y="317.5" width="61" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="43" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="41" target="42" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="46" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="41" target="44" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="47" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="41" target="45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="string类型的三种底层实现" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="780" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="50" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="42" target="49" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="42" value="int" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="670" width="45" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="118" style="edgeStyle=orthogonalEdgeStyle;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="44" target="117" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="44" value="raw" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="1007.13" width="45" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="64" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="45" target="63" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="45" value="embStr" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="785" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="48" value="场景" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="343" y="620" width="45" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="54" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#6262FC;" parent="1" source="49" target="53" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="49" value="① 字符串长度小于20&lt;br&gt;② 可以转换为long long整型（8字节以内）" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="264" y="665" width="236" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;指向底层实现结构体（真正的数据）&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="399" y="202" width="171" height="26.25" as="geometry"/>
                </mxCell>
                <mxCell id="52" value="底层实现" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="590" y="620" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="57" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="53" target="56" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="53" value="直接存放在redisObject的ptr字段上&lt;br&gt;（指针类型，8个字节，正好存储long long数据）" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="530" y="665" width="270" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="61" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="56" target="60" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="56" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;span style=&quot;color: #795e26&quot;&gt;sdsfree&lt;/span&gt;(o-&amp;gt;&lt;span style=&quot;color: #660e7a&quot;&gt;ptr&lt;/span&gt;);&lt;br&gt;o-&amp;gt;&lt;span style=&quot;color: #660e7a&quot;&gt;encoding &lt;/span&gt;= &lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_INT&lt;/span&gt;;&lt;br&gt;o-&amp;gt;&lt;span style=&quot;color: #660e7a&quot;&gt;ptr &lt;/span&gt;= (&lt;span style=&quot;color: #0033b3&quot;&gt;void&lt;/span&gt;*) &lt;span style=&quot;color: #000000&quot;&gt;value&lt;/span&gt;;&lt;br&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;return &lt;/span&gt;o;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="827" y="655" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="58" value="object.c 479L" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="827" y="635" width="83" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="59" value="案例" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="1120" y="600" width="50" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="60" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;comic=1;sketch=1;fontSize=11;fontColor=#6262FC;strokeColor=default;fillColor=none;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/image-20220808220659289.png;imageBorder=default;" parent="1" vertex="1">
                    <mxGeometry x="1050" y="641" width="205.47" height="88" as="geometry"/>
                </mxCell>
                <mxCell id="62" value="为string选择实现方式的代码在object.c的&lt;br&gt;&lt;b&gt;robj *tryObjectEncoding(robj *o)&lt;/b&gt; 函数内" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="70" y="620" width="230" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="107" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="63" target="80" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="63" value="字符串长度小于44字节" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="271" y="785" width="140" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="68" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="65" target="67" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="70" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="65" target="69" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="65" value="字符串内容存放的数据结构sds" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;" parent="1" vertex="1">
                    <mxGeometry x="40" y="480" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="67" value="sds有多种类型：sdshdr5，sdshdr8，sdshdr16，sdshdr32，sdshdr64" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="440" width="215" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="69" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;struct __attribute__ &lt;/span&gt;((__packed__)) &lt;span style=&quot;color: #008080&quot;&gt;sdshdr8 &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;color: #371f80&quot;&gt;uint8_t &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;len&lt;/span&gt;; &lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* used */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #371f80&quot;&gt;uint8_t &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;alloc&lt;/span&gt;; &lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* excluding the header and null terminator */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;unsigned char &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;flags&lt;/span&gt;; &lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* 3 lsb of type, 5 unused bits */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #0033b3&quot;&gt;char &lt;/span&gt;&lt;span style=&quot;color: #660e7a&quot;&gt;buf&lt;/span&gt;[];&lt;br&gt;};&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="180" y="490" width="400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="71" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;实际字符串长度&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="345" y="500" width="75" height="17.5" as="geometry"/>
                </mxCell>
                <mxCell id="72" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;分配的大小&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="580" y="517.5" width="75" height="17.5" as="geometry"/>
                </mxCell>
                <mxCell id="77" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="74" target="72" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="74" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;最低三位表示类型&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="540" y="530" width="90" height="17.5" as="geometry"/>
                </mxCell>
                <mxCell id="76" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;SDS_TYPE_5  &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;SDS_TYPE_8  &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;SDS_TYPE_16 &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;2&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;SDS_TYPE_32 &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;3&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;SDS_TYPE_64 &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="655" y="496.88" width="130" height="66.25" as="geometry"/>
                </mxCell>
                <mxCell id="78" value="&lt;font color=&quot;#6262fc&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;存放字符串的字符数组&lt;/span&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=none;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="277" y="543.63" width="110" height="17.5" as="geometry"/>
                </mxCell>
                <mxCell id="81" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* The actual Redis Object */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_STRING &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;0    &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* String object. */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_LIST &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;1      &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* List object. */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_SET &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;2       &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Set object. */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ZSET &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;3      &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Sorted set object. */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_HASH &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;4      &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Hash object. */&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="827" y="60" width="290" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(8 , 8 , 8) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_RAW &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;0     &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Raw representation */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_INT &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;1     &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as integer */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_HT &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;2      &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as hash table */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_ZIPMAP &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;3  &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as zipmap */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_LINKEDLIST &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;4 &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* No longer used: old list encoding. */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_ZIPLIST &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;5 &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as ziplist */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_INTSET &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;6  &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as intset */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_SKIPLIST &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;7  &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as skiplist */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_EMBSTR &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;8  &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Embedded sds string encoding */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_QUICKLIST &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;9 &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as linked list of ziplists */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #9e880d&quot;&gt;#define &lt;/span&gt;&lt;span style=&quot;color: #1f542e ; font-weight: bold&quot;&gt;OBJ_ENCODING_STREAM &lt;/span&gt;&lt;span style=&quot;color: #1750eb&quot;&gt;10 &lt;/span&gt;&lt;span style=&quot;color: #8c8c8c ; font-style: italic&quot;&gt;/* Encoded as a radix tree of listpacks */&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=0;align=left;" parent="1" vertex="1">
                    <mxGeometry x="827" y="146.25" width="453" height="147.5" as="geometry"/>
                </mxCell>
                <mxCell id="114" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" parent="1" source="110" target="113" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="112" style="edgeStyle=orthogonalEdgeStyle;sketch=1;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="1" source="92" target="110" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="840" y="800" as="sourcePoint"/>
                        <mxPoint x="480" y="795" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="113" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;comic=0;sketch=0;fontSize=11;fontColor=#6262FC;strokeColor=default;fillColor=default;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/image-20220808225850728.png;" parent="1" vertex="1">
                    <mxGeometry x="1300" y="808.4599999999999" width="230" height="53.07" as="geometry"/>
                </mxCell>
                <mxCell id="115" value="" style="group" parent="1" vertex="1" connectable="0">
                    <mxGeometry x="870" y="740" width="403" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="110" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;consolas&amp;#34; , monospace ; font-size: 11px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;consolas&amp;#34; , monospace&quot;&gt;&lt;span style=&quot;color: rgb(55 , 31 , 128)&quot;&gt;robj &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;*&lt;/font&gt;&lt;span style=&quot;color: rgb(121 , 94 , 38)&quot;&gt;createEmbeddedStringObject&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;(&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;const char &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;*ptr, &lt;/font&gt;&lt;span style=&quot;color: rgb(55 , 31 , 128)&quot;&gt;size_t &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;len) {&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(55 , 31 , 128)&quot;&gt;robj &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;*&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= &lt;/font&gt;&lt;span style=&quot;color: rgb(121 , 94 , 38)&quot;&gt;zmalloc&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;(&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;sizeof&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;(&lt;/font&gt;&lt;span style=&quot;color: rgb(55 , 31 , 128)&quot;&gt;robj&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;)+&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;sizeof&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;(&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;struct &lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 128 , 128)&quot;&gt;sdshdr8&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;)+len+&lt;/font&gt;&lt;span style=&quot;color: rgb(23 , 80 , 235)&quot;&gt;1&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;);&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;struct &lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 128 , 128)&quot;&gt;sdshdr8 &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;*&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;sh &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= (&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;void&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;*)(&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;+&lt;/font&gt;&lt;span style=&quot;color: rgb(23 , 80 , 235)&quot;&gt;1&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;);&lt;br&gt;&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;-&amp;gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(102 , 14 , 122)&quot;&gt;type &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= &lt;/font&gt;&lt;span style=&quot;color: rgb(31 , 84 , 46) ; font-weight: bold&quot;&gt;OBJ_STRING&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;;&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;-&amp;gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(102 , 14 , 122)&quot;&gt;encoding &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= &lt;/font&gt;&lt;span style=&quot;color: rgb(31 , 84 , 46) ; font-weight: bold&quot;&gt;OBJ_ENCODING_EMBSTR&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;;&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;-&amp;gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(102 , 14 , 122)&quot;&gt;ptr &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;sh&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;+&lt;/font&gt;&lt;span style=&quot;color: rgb(23 , 80 , 235)&quot;&gt;1&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;;&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;-&amp;gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(102 , 14 , 122)&quot;&gt;refcount &lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;= &lt;/font&gt;&lt;span style=&quot;color: rgb(23 , 80 , 235)&quot;&gt;1&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;;&lt;br&gt;    &lt;/font&gt;&lt;font color=&quot;#0033b3&quot;&gt;...&lt;/font&gt;&lt;font color=&quot;#080808&quot;&gt;&lt;br&gt;    &lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 51 , 179)&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;color: rgb(0 , 0 , 0)&quot;&gt;o&lt;/span&gt;&lt;font color=&quot;#080808&quot;&gt;;&lt;br&gt;}&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;align=left;" parent="115" vertex="1">
                    <mxGeometry y="20" width="403" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="111" value="object.c 84L" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#b0e3e6;strokeColor=#0e8088;comic=1;" parent="115" vertex="1">
                    <mxGeometry width="83" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="116" value="原因：&lt;br&gt;CPU缓存行通常为64字节&lt;br&gt;redisObject占用16字节&lt;br&gt;sdshdr8除去字符串占用：1+1+1+1(填入字符串后还需尾部还需填一个'\0')=4字节&lt;br&gt;那么64-16-4=44，即还剩下44字节，如果使用这44字节直接存放字符串则可以充分利用CPU缓存，提高读取性能" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;sketch=1;align=left;" parent="1" vertex="1">
                    <mxGeometry x="230" y="831.53" width="249" height="118.47" as="geometry"/>
                </mxCell>
                <mxCell id="144" style="sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" edge="1" parent="1" source="117" target="143">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="117" value="其余情况" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;align=center;" parent="1" vertex="1">
                    <mxGeometry x="301" y="1007.13" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="79" value="&lt;b&gt;redisObject&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="1" vertex="1">
                    <mxGeometry x="470" y="760" width="200" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="80" value="&lt;b&gt;type&lt;br&gt;OBJ_STRING&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="1" vertex="1">
                    <mxGeometry x="470" y="785" width="80" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="85" value="&lt;b&gt;encoding&lt;br&gt;embstr&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="1" vertex="1">
                    <mxGeometry x="550" y="785" width="70" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="86" value="&lt;b&gt;ptr&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="1" vertex="1">
                    <mxGeometry x="620" y="785" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="88" value="&lt;b&gt;SDS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
                    <mxGeometry x="670" y="760" width="150" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="90" value="&lt;b&gt;len&lt;br&gt;6&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
                    <mxGeometry x="670" y="785" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="91" value="&lt;b&gt;alloc&lt;br&gt;6&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
                    <mxGeometry x="720" y="785" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="92" value="&lt;b&gt;buf&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" parent="1" vertex="1">
                    <mxGeometry x="770" y="785" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="93" value="&lt;b&gt;h&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="731" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="94" value="&lt;b&gt;e&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="751" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="95" value="&lt;b&gt;l&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="771" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="96" value="&lt;b&gt;l&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="791" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="97" value="&lt;b&gt;o&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="811" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="99" value="&lt;b&gt;\0&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#0e8088;fillColor=#b0e3e6;" parent="1" vertex="1">
                    <mxGeometry x="831" y="845.5" width="20" height="22.5" as="geometry"/>
                </mxCell>
                <mxCell id="100" value="" style="endArrow=none;html=1;sketch=1;fontSize=11;fontColor=#6262FC;entryX=1;entryY=1;entryDx=0;entryDy=0;exitX=0;exitY=0;exitDx=0;exitDy=0;" parent="1" source="93" target="91" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="500" y="907.5" as="sourcePoint"/>
                        <mxPoint x="550" y="857.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="101" value="" style="endArrow=none;html=1;sketch=1;fontSize=11;fontColor=#6262FC;entryX=1;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0;exitDx=0;exitDy=0;" parent="1" source="99" target="92" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="700" y="867.5" as="sourcePoint"/>
                        <mxPoint x="780" y="827.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="135" style="edgeStyle=orthogonalEdgeStyle;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" edge="1" parent="1" source="122" target="123">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="137" value="" style="group" vertex="1" connectable="0" parent="1">
                    <mxGeometry x="455" y="991.25" width="200" height="57.5" as="geometry"/>
                </mxCell>
                <mxCell id="119" value="&lt;b&gt;redisObject&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="137" vertex="1">
                    <mxGeometry width="200" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="120" value="&lt;b&gt;type&lt;br&gt;OBJ_STRING&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="137" vertex="1">
                    <mxGeometry y="25" width="80" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="121" value="&lt;b&gt;encoding&lt;br&gt;raw&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="137" vertex="1">
                    <mxGeometry x="80" y="25" width="70" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="122" value="&lt;b&gt;ptr&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#b85450;fillColor=#f8cecc;" parent="137" vertex="1">
                    <mxGeometry x="150" y="25" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="123" value="&lt;b&gt;SDS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
                    <mxGeometry x="685.5" y="991.25" width="150" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="124" value="&lt;b&gt;len&lt;br&gt;100&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
                    <mxGeometry x="685.5" y="1016.25" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="125" value="&lt;b&gt;alloc&lt;br&gt;80&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
                    <mxGeometry x="735.5" y="1016.25" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="126" value="&lt;b&gt;buf&lt;br&gt;...&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;comic=0;sketch=0;fontSize=11;strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
                    <mxGeometry x="785.5" y="1016.25" width="50" height="32.5" as="geometry"/>
                </mxCell>
                <mxCell id="145" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;comic=0;sketch=1;fontSize=11;fontColor=#6262FC;strokeColor=default;fillColor=default;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/image-20220808232545936.png;" vertex="1" parent="1">
                    <mxGeometry x="890" y="996.45" width="544.77" height="51.34" as="geometry"/>
                </mxCell>
                <mxCell id="149" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" edge="1" parent="1" source="147" target="148">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="147" value="当对一个原来的embStr进行append后，该字符串会被转换为raw" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;comic=1;sketch=1;align=center;" vertex="1" parent="1">
                    <mxGeometry x="190" y="1074" width="190" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="151" style="edgeStyle=none;sketch=1;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#6262FC;" edge="1" parent="1" source="148" target="150">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="148" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;comic=0;sketch=1;fontSize=11;fontColor=#6262FC;strokeColor=default;fillColor=default;image=https://codereaper-image-bed.oss-cn-shenzhen.aliyuncs.com/img/image-20220808232936114.png;imageBorder=default;" vertex="1" parent="1">
                    <mxGeometry x="444.78999999999996" y="1074" width="210.21" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="150" value="如果继续使用raw的话，那么每次进行append时都需要重新分配redisObject+SDS的内存空间，比较浪费" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;align=left;" vertex="1" parent="1">
                    <mxGeometry x="710" y="1096" width="230" height="51" as="geometry"/>
                </mxCell>
                <mxCell id="152" value="使用embStr的优点：&lt;br&gt;① 充分利用CPU缓存行&lt;br&gt;② 删除字符串只需free一次，而raw需要free redisObject+SDS 两次" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;comic=1;sketch=1;align=left;" vertex="1" parent="1">
                    <mxGeometry x="493" y="831.53" width="217" height="70" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>